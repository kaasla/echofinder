#!/bin/bash
# Conventional Commits enforcement hook
# Validates commit message format: type(scope?): description

commit_msg_file="$1"
commit_msg=$(cat "$commit_msg_file")

# Allow merge commits
if echo "$commit_msg" | grep -qE "^Merge "; then
    exit 0
fi

# Conventional Commits pattern
# type(scope): description  OR  type: description
pattern="^(feat|fix|docs|style|refactor|perf|test|build|ci|chore)(\([a-zA-Z0-9_-]+\))?: .+"

if ! echo "$commit_msg" | grep -qE "$pattern"; then
    echo ""
    echo "ERROR: Commit message does not follow Conventional Commits format."
    echo ""
    echo "Expected format: type(scope?): description"
    echo ""
    echo "Valid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore"
    echo ""
    echo "Examples:"
    echo "  feat: add user authentication"
    echo "  fix(backend): handle null pointer in health check"
    echo "  docs: update API documentation"
    echo ""
    echo "Your message was:"
    echo "  $commit_msg"
    echo ""
    exit 1
fi

exit 0